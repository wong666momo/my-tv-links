name: Update 8TV Stream Link

on:
  workflow_dispatch:
  schedule:
    - cron: '*/15 * * * *'

jobs:
  update-link:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install Streamlink
        run: pip install streamlink

      - name: Get stream link and save to file
        run: streamlink --http-header "User-Agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36" --http-header "Referer=https://www.tonton.com.my/" --stream-url "https://www.tonton.com.my/live/8tv" best > 8tv.m3u8 || echo "Streamlink failed but the job will not fail."

      - name: Commit and push if changed
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Update 8tv.m3u8 link"
          file_pattern: 8tv.m3u8
